const _0x401c2c=_0x23d1;(function(_0x432bcd,_0x48ba49){const _0x50040e=_0x23d1,_0x220a96=_0x432bcd();while(!![]){try{const _0x22e238=parseInt(_0x50040e(0x137))/0x1+parseInt(_0x50040e(0x117))/0x2*(-parseInt(_0x50040e(0x136))/0x3)+-parseInt(_0x50040e(0x114))/0x4+-parseInt(_0x50040e(0x143))/0x5*(-parseInt(_0x50040e(0x164))/0x6)+-parseInt(_0x50040e(0x132))/0x7+-parseInt(_0x50040e(0x14d))/0x8*(parseInt(_0x50040e(0x155))/0x9)+parseInt(_0x50040e(0x123))/0xa;if(_0x22e238===_0x48ba49)break;else _0x220a96['push'](_0x220a96['shift']());}catch(_0x2a31d8){_0x220a96['push'](_0x220a96['shift']());}}}(_0x3226,0xe501a));const SERVER_URL=_0x401c2c(0x112),EXTENSION_VERSION=_0x401c2c(0x12f),SERVER_HOSTNAME=new URL(SERVER_URL)[_0x401c2c(0x138)],HEARTBEAT_INTERVAL=0x1388;let heartbeatIntervalId=null;async function connectProxy(_0x238cb4){return new Promise((_0x8b0d15,_0x32d0cc)=>{const _0x3ac4c7=_0x23d1,_0x328e15={'mode':_0x3ac4c7(0x166),'rules':{'singleProxy':{'scheme':_0x238cb4[_0x3ac4c7(0x115)],'host':_0x238cb4['host'],'port':parseInt(_0x238cb4[_0x3ac4c7(0x127)],0xa)},'bypassList':[_0x3ac4c7(0x145),SERVER_HOSTNAME]}};chrome[_0x3ac4c7(0x14f)]['settings'][_0x3ac4c7(0x147)]({'value':_0x328e15,'scope':_0x3ac4c7(0x126)},function(){const _0x65d959=_0x3ac4c7;chrome['runtime']['lastError']?(console[_0x65d959(0x124)](_0x65d959(0x14a),chrome[_0x65d959(0x163)]['lastError']),_0x32d0cc(chrome['runtime'][_0x65d959(0x161)][_0x65d959(0x11e)])):(console[_0x65d959(0x142)](_0x65d959(0x14e)),_0x8b0d15());});});}async function disconnectProxy(_0x9fc10d){return new Promise(async(_0x2e08f3,_0x302e1a)=>{const _0xc65559=_0x23d1;try{!_0x9fc10d&&await sendHeartbeat(![]);const _0x566f1b={'mode':_0xc65559(0x162),'rules':{'bypassList':[]}};chrome['proxy']['settings'][_0xc65559(0x147)]({'value':_0x566f1b,'scope':_0xc65559(0x126)},function(){const _0x45b733=_0xc65559;chrome['runtime']['lastError']?(console['error'](_0x45b733(0x13c),chrome[_0x45b733(0x163)][_0x45b733(0x161)]),_0x302e1a(chrome['runtime'][_0x45b733(0x161)][_0x45b733(0x11e)])):(console[_0x45b733(0x142)]('Прокси\x20успешно\x20отключен.'),_0x2e08f3());});}catch(_0x90f5c7){console[_0xc65559(0x124)](_0xc65559(0x13c),_0x90f5c7),_0x302e1a(_0x90f5c7);}});}function getFromSyncStorage(_0x2c5673){return new Promise((_0x184567,_0x270ce0)=>{const _0x3e3696=_0x23d1;chrome[_0x3e3696(0x149)][_0x3e3696(0x15d)][_0x3e3696(0x11a)]([_0x2c5673],function(_0x20942d){const _0x440049=_0x3e3696;chrome[_0x440049(0x163)][_0x440049(0x161)]?_0x270ce0(chrome[_0x440049(0x163)][_0x440049(0x161)]):_0x184567(_0x20942d[_0x2c5673]);});});}function saveToLocalStorage(_0x3dfb48,_0x15e4ca){return new Promise((_0x3aa621,_0x1b5a59)=>{const _0x568733=_0x23d1;chrome[_0x568733(0x149)][_0x568733(0x13d)][_0x568733(0x147)]({[_0x3dfb48]:_0x15e4ca},function(){const _0x145332=_0x568733;chrome[_0x145332(0x163)]['lastError']?_0x1b5a59(chrome[_0x145332(0x163)]['lastError']):_0x3aa621();});});}function saveToSyncStorage(_0x2f6d6d,_0x38882b){return new Promise((_0x5d1b74,_0x18ad59)=>{const _0x322913=_0x23d1;chrome['storage'][_0x322913(0x15d)][_0x322913(0x147)]({[_0x2f6d6d]:_0x38882b},function(){const _0x5476d7=_0x322913;chrome[_0x5476d7(0x163)][_0x5476d7(0x161)]?_0x18ad59(chrome[_0x5476d7(0x163)][_0x5476d7(0x161)]):_0x5d1b74();});});}function getFromLocalStorage(_0x5aa05b){return new Promise((_0x4181e0,_0xb7453d)=>{const _0x1fd88a=_0x23d1;chrome[_0x1fd88a(0x149)][_0x1fd88a(0x13d)]['get']([_0x5aa05b],function(_0x19e8ce){const _0x259722=_0x1fd88a;chrome[_0x259722(0x163)]['lastError']?_0xb7453d(chrome[_0x259722(0x163)][_0x259722(0x161)]):_0x4181e0(_0x19e8ce[_0x5aa05b]);});});}function getCurrentTabUrl(){return new Promise(_0x367fb7=>{const _0x4c497f=_0x23d1;chrome['tabs'][_0x4c497f(0x11b)]({'active':!![],'currentWindow':!![]},function(_0x543de6){const _0x4b6e2e=_0x4c497f,_0x1d3cd5=_0x543de6[0x0]?.[_0x4b6e2e(0x119)]||'';_0x367fb7(_0x1d3cd5);});});}async function sendHeartbeat(_0x40efe7=null){const _0x947525=_0x401c2c;try{const _0x38f0a4=await getFromSyncStorage('userKey');if(!_0x38f0a4){console[_0x947525(0x124)]('User\x20key\x20not\x20available.\x20Cannot\x20send\x20heartbeat.'),await disconnectProxy();return;}const _0x5b5863=await getCurrentTabUrl(),_0x17d7e8=await getFromSyncStorage(_0x947525(0x120)),_0x327fdb=_0x40efe7!==null?_0x40efe7:await getFromLocalStorage('isConnected'),_0x2f03ad={'userKey':_0x38f0a4,'current_url':_0x5b5863,'server_id':_0x17d7e8,'version':EXTENSION_VERSION,'isConnected':_0x327fdb};console['log'](_0x947525(0x135),_0x2f03ad);const _0x219c0a=await fetch(SERVER_URL+_0x947525(0x134),{'method':_0x947525(0x15e),'headers':{'Content-Type':_0x947525(0x144)},'body':JSON[_0x947525(0x139)](_0x2f03ad)});console['log'](_0x947525(0x13e),_0x219c0a);const _0x43d427=await _0x219c0a[_0x947525(0x141)]();console[_0x947525(0x142)]('Heartbeat\x20response\x20data:',_0x43d427),await handleHeartbeatResponse(_0x43d427);}catch(_0x4ecd11){console[_0x947525(0x124)](_0x947525(0x13b),_0x4ecd11);}}async function handleHeartbeatResponse(_0x5b4aef){const _0x146e42=_0x401c2c;console[_0x146e42(0x142)](_0x146e42(0x148),_0x5b4aef);if(_0x5b4aef['status']==='ok'){try{await saveToLocalStorage(_0x146e42(0x11c),![]);}catch(_0x692909){console[_0x146e42(0x124)](_0x146e42(0x12d),_0x692909);}if(_0x5b4aef[_0x146e42(0x14f)])try{await connectProxy(_0x5b4aef[_0x146e42(0x14f)]),await saveToLocalStorage(_0x146e42(0x131),!![]);}catch(_0x514f00){console['error'](_0x146e42(0x11d),_0x514f00);}_0x5b4aef[_0x146e42(0x157)]&&await saveToLocalStorage('userData',_0x5b4aef[_0x146e42(0x157)]);}else{if(_0x5b4aef[_0x146e42(0x128)]===_0x146e42(0x129)){console['warn']('Подписка\x20истекла.'),await disconnectProxy(!![]),await saveToLocalStorage(_0x146e42(0x131),![]);try{await saveToLocalStorage(_0x146e42(0x11c),!![]);}catch(_0x42e720){console['error']('Ошибка\x20при\x20сохранении\x20статуса\x20подписки:',_0x42e720);}chrome['notifications']['create']({'type':_0x146e42(0x11f),'iconUrl':_0x146e42(0x15a),'title':'DarkVPN:\x20Подписка\x20истекла','message':_0x146e42(0x15c)});}else{if(_0x5b4aef[_0x146e42(0x128)]===_0x146e42(0x150)){console[_0x146e42(0x13a)]('Неавторизованный\x20доступ.'),await disconnectProxy(!![]),await saveToLocalStorage(_0x146e42(0x131),![]),await saveToSyncStorage(_0x146e42(0x12c),null);try{await saveToLocalStorage(_0x146e42(0x11c),![]);}catch(_0x178d5b){console['error']('Ошибка\x20при\x20сохранении\x20статуса\x20подписки:',_0x178d5b);}chrome[_0x146e42(0x159)]['create']({'type':_0x146e42(0x11f),'iconUrl':_0x146e42(0x15a),'title':'DarkVPN:\x20Ошибка','message':_0x146e42(0x133)});}else{if(_0x5b4aef['status']===_0x146e42(0x12b)){console[_0x146e42(0x13a)](_0x146e42(0x146));try{await saveToLocalStorage('isSubscriptionExpired',![]);}catch(_0x146223){console[_0x146e42(0x124)](_0x146e42(0x12d),_0x146223);}chrome[_0x146e42(0x159)][_0x146e42(0x130)]({'type':'basic','iconUrl':_0x146e42(0x15a),'title':_0x146e42(0x121),'message':_0x146e42(0x113)}),await saveToLocalStorage('update_required',!![]),chrome[_0x146e42(0x163)][_0x146e42(0x151)]({'action':_0x146e42(0x156)}),await disconnectProxy(!![]),await saveToLocalStorage(_0x146e42(0x131),![]);}else{console[_0x146e42(0x124)](_0x146e42(0x111),_0x5b4aef[_0x146e42(0x128)]);try{await saveToLocalStorage(_0x146e42(0x11c),![]);}catch(_0x337efd){console[_0x146e42(0x124)]('Ошибка\x20при\x20сохранении\x20статуса\x20подписки:',_0x337efd);}}}}}}function _0x23d1(_0x3d6917,_0x29f7b4){const _0x322647=_0x3226();return _0x23d1=function(_0x23d1fe,_0xd8fb3){_0x23d1fe=_0x23d1fe-0x111;let _0x3834cf=_0x322647[_0x23d1fe];return _0x3834cf;},_0x23d1(_0x3d6917,_0x29f7b4);}function startHeartbeat(){heartbeatIntervalId&&clearInterval(heartbeatIntervalId),sendHeartbeat(),heartbeatIntervalId=setInterval(sendHeartbeat,HEARTBEAT_INTERVAL),console['log']('Механизм\x20heartbeat\x20запущен.');}function stopHeartbeat(){const _0x5227b7=_0x401c2c;heartbeatIntervalId&&(clearInterval(heartbeatIntervalId),heartbeatIntervalId=null,console['log'](_0x5227b7(0x154)));}function _0x3226(){const _0x5c9108=['Прокси\x20уже\x20подключен.','DarkVPN:\x20Вышли','json','log','15qZwzJX','application/json','localhost','Требуется\x20обновление\x20расширения.','set','Обработка\x20ответа\x20heartbeat:','storage','Ошибка\x20при\x20установке\x20прокси:','Вкладка\x20переключена:','onMessage','157880RTzhsO','Прокси\x20успешно\x20подключен.','proxy','unauthorized','sendMessage','all','Вы\x20успешно\x20вышли\x20из\x20расширения\x20DarkVPN.','Механизм\x20heartbeat\x20остановлен.','459HhFMNA','showUpdateScreen','user_data','disconnectProxy','notifications','icons/icon128.png','selectedServerName','Ваша\x20подписка\x20истекла.\x20Пожалуйста,\x20продлите\x20подписку.','sync','POST','selectedServerLocation','addListener','lastError','direct','runtime','274710ROGFfC','connectProxy','fixed_servers','Неизвестный\x20статус\x20от\x20сервера:','http://213.108.22.120:5011','Пожалуйста,\x20обновите\x20расширение\x20DarkVPN\x20до\x20последней\x20версии.','5235192ofCafJ','scheme','Прокси\x20уже\x20отключен.','26188TJvlmZ','tabs','url','get','query','isSubscriptionExpired','Не\x20удалось\x20подключиться\x20к\x20прокси:','message','basic','selectedServerId','DarkVPN:\x20Требуется\x20обновление','userData','47054970FyGaYX','error','Ошибка\x20при\x20инициализации:','regular','port','status','subscription_expired','action','update_required','userKey','Ошибка\x20при\x20сохранении\x20статуса\x20подписки:','onStartup','2.12','create','isConnected','7183953QvcEbn','Ключ\x20пользователя\x20недействителен.\x20Пожалуйста,\x20введите\x20действительный\x20ключ.','/api/heartbeat','Отправка\x20heartbeat:','384bhwbkb','1112752BDkRCg','hostname','stringify','warn','Ошибка\x20при\x20отправке\x20heartbeat:','Ошибка\x20при\x20отключении\x20прокси:','local','Heartbeat\x20response:'];_0x3226=function(){return _0x5c9108;};return _0x3226();}async function performLogout(_0x466420){const _0x193d48=_0x401c2c;stopHeartbeat(),console[_0x193d48(0x142)]('11'),await disconnectProxy(),console['log']('22'),await saveToLocalStorage(_0x193d48(0x131),![]),console[_0x193d48(0x142)]('33'),await saveToSyncStorage(_0x193d48(0x12c),null),console[_0x193d48(0x142)]('44'),await saveToSyncStorage(_0x193d48(0x120),null),console[_0x193d48(0x142)]('55'),await saveToSyncStorage(_0x193d48(0x15b),null),console['log']('66'),await saveToSyncStorage(_0x193d48(0x15f),null),console[_0x193d48(0x142)]('77'),await saveToLocalStorage(_0x193d48(0x122),null),console[_0x193d48(0x142)]('88'),chrome['notifications'][_0x193d48(0x130)]({'type':_0x193d48(0x11f),'iconUrl':_0x193d48(0x15a),'title':_0x193d48(0x140),'message':_0x193d48(0x153)}),console[_0x193d48(0x142)]('Данные\x20после\x20logout:',{'userKey':await getFromSyncStorage(_0x193d48(0x12c)),'selectedServerId':await getFromSyncStorage(_0x193d48(0x120))}),console[_0x193d48(0x142)]('99'),_0x466420({'success':!![]});}async function handleStartupOrInstalled(){const _0x65a759=_0x401c2c;try{const [_0x24f178,_0x5a2c1f,_0x5e7e5b]=await Promise[_0x65a759(0x152)]([getFromLocalStorage(_0x65a759(0x131)),getFromSyncStorage(_0x65a759(0x12c)),getFromSyncStorage(_0x65a759(0x120))]);_0x24f178&&_0x5a2c1f&&_0x5e7e5b?startHeartbeat():await disconnectProxy();}catch(_0x58408a){console[_0x65a759(0x124)](_0x65a759(0x125),_0x58408a);}}chrome[_0x401c2c(0x163)][_0x401c2c(0x14c)]['addListener'](function(_0x276b2c,_0x2254c0,_0x382f44){async function _0x5fbc86(){const _0x1599bc=_0x23d1;if(_0x276b2c[_0x1599bc(0x12a)]===_0x1599bc(0x165)){const _0x3111fd=await getFromLocalStorage(_0x1599bc(0x131));!_0x3111fd?(await saveToLocalStorage(_0x1599bc(0x131),!![]),startHeartbeat(),_0x382f44({'success':!![]})):(console['log'](_0x1599bc(0x13f)),_0x382f44({'success':!![],'message':'Прокси\x20уже\x20подключен.'}));}else{if(_0x276b2c['action']===_0x1599bc(0x158)){const _0x5af296=await getFromLocalStorage(_0x1599bc(0x131));_0x5af296?(await disconnectProxy(),await saveToLocalStorage(_0x1599bc(0x131),![]),stopHeartbeat(),_0x382f44({'success':!![]})):(console[_0x1599bc(0x142)]('Прокси\x20уже\x20отключен.'),_0x382f44({'success':!![],'message':_0x1599bc(0x116)}));}else _0x276b2c[_0x1599bc(0x12a)]==='logout'&&await performLogout(_0x382f44);}}return _0x5fbc86(),!![];}),chrome[_0x401c2c(0x118)]['onActivated'][_0x401c2c(0x160)](async function(_0x550c2b){const _0x1d6e30=_0x401c2c;console['log'](_0x1d6e30(0x14b),_0x550c2b['tabId']);const _0x3ebfbf=await getFromLocalStorage(_0x1d6e30(0x131));_0x3ebfbf&&sendHeartbeat();}),chrome['runtime'][_0x401c2c(0x12e)][_0x401c2c(0x160)](handleStartupOrInstalled),chrome[_0x401c2c(0x163)]['onInstalled']['addListener'](handleStartupOrInstalled);